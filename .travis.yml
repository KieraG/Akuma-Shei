language: cpp
sudo: required

matrix:
  include:
  - name: "Linux: Clang 8"
    os: linux
    dist: bionic
    compiler:
      - clang
    addons:
      apt:
        packages:
          - clang-8
          - libc++-dev
          - libc++abi-dev
          - libsdl2-dev
          - libsdl2-*-dev
          - libglm-dev
          - libgl1-mesa-dev
    env:
      - CC=clang-8 CXX=clang++-8

  - name: "Linux: GCC 8"
    os: linux
    dist: bionic
    compiler:
      - gcc
    addons:
      apt:
        packages:
          - g++-8
          - libsdl2-dev
          - libsdl2-*-dev
          - libglm-dev
          - libgl1-mesa-dev
    env:
      - CC=gcc-8 CXX=g++-8

  - name: "macOS: Xcode 11"
    os: osx
    osx_image: xcode11
    env:
      - BREW_PACKAGES="sdl2 sdl2_image sdl2_ttf sdl2_mixer glm"

  - name: "Windows: Visual Studio 2017"
    os: windows
    env:
    - VCPKG_ROOT=/c/vcpkg
    - MSBUILD_PATH="/c/Program Files (x86)/Microsoft Visual Studio/2017/BuildTools/MSBuild/15.0/Bin"

before_script: ./.travis/install-dependencies.sh
script: ./.travis/build.sh
after_failure: ./.travis/failure.sh
before_deploy: ./.travis/before-deploy.sh
deploy:
  provider: releases
  api_key: ${GITHUB_TOKEN}
  file: "build/${TRAVIS_TAG}-${TRAVIS_OS_NAME}.tar.gz"
  skip_cleanup: true
  on:
    tags: true
